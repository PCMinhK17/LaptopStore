@{
    ViewData["Title"] = "Cài đặt hệ thống";
    ViewData["Subtitle"] = "Tùy chỉnh giao diện và cấu hình hệ thống";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<!-- Page Header -->
<div class="page-header">
    <div class="page-header-left">
        <h2>Cài đặt hệ thống</h2>
        <p>Tùy chỉnh giao diện và cấu hình cho admin panel</p>
    </div>
</div>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success mb-4" style="background: var(--success-100); color: var(--success-700); border: 1px solid var(--success-200); border-radius: var(--radius-lg); padding: 1rem 1.25rem;">
        <i class="fas fa-check-circle me-2"></i>
        @TempData["SuccessMessage"]
    </div>
}

<div class="row g-4">
    <!-- Theme Settings -->
    <div class="col-12 col-lg-6">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title">
                    <i class="fas fa-palette"></i>
                    Giao diện
                </h5>
            </div>
            <div class="card-body">
                <!-- Theme Mode -->
                <div class="setting-item mb-4">
                    <div class="setting-label">
                        <h6 class="mb-1">Chế độ giao diện</h6>
                        <p class="text-muted mb-0 small">Chọn chế độ sáng hoặc tối cho giao diện</p>
                    </div>
                    <div class="theme-options mt-3">
                        <div class="theme-option" data-theme="light">
                            <div class="theme-preview light">
                                <div class="theme-preview-sidebar"></div>
                                <div class="theme-preview-content">
                                    <div class="theme-preview-header"></div>
                                    <div class="theme-preview-body"></div>
                                </div>
                            </div>
                            <span class="theme-label">
                                <i class="fas fa-sun me-1"></i> Sáng
                            </span>
                        </div>
                        <div class="theme-option" data-theme="dark">
                            <div class="theme-preview dark">
                                <div class="theme-preview-sidebar"></div>
                                <div class="theme-preview-content">
                                    <div class="theme-preview-header"></div>
                                    <div class="theme-preview-body"></div>
                                </div>
                            </div>
                            <span class="theme-label">
                                <i class="fas fa-moon me-1"></i> Tối
                            </span>
                        </div>
                        <div class="theme-option" data-theme="auto">
                            <div class="theme-preview auto">
                                <div class="theme-preview-sidebar"></div>
                                <div class="theme-preview-content">
                                    <div class="theme-preview-header"></div>
                                    <div class="theme-preview-body"></div>
                                </div>
                            </div>
                            <span class="theme-label">
                                <i class="fas fa-adjust me-1"></i> Tự động
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Primary Color -->
                <div class="setting-item mb-4">
                    <div class="setting-label">
                        <h6 class="mb-1">Màu chủ đạo</h6>
                        <p class="text-muted mb-0 small">Chọn màu chính cho giao diện</p>
                    </div>
                    <div class="color-options mt-3">
                        <button type="button" class="color-option" data-color="#6366f1" style="--color: #6366f1;" title="Indigo"></button>
                        <button type="button" class="color-option" data-color="#8b5cf6" style="--color: #8b5cf6;" title="Purple"></button>
                        <button type="button" class="color-option" data-color="#3b82f6" style="--color: #3b82f6;" title="Blue"></button>
                        <button type="button" class="color-option" data-color="#06b6d4" style="--color: #06b6d4;" title="Cyan"></button>
                        <button type="button" class="color-option" data-color="#10b981" style="--color: #10b981;" title="Emerald"></button>
                        <button type="button" class="color-option" data-color="#f59e0b" style="--color: #f59e0b;" title="Amber"></button>
                        <button type="button" class="color-option" data-color="#ef4444" style="--color: #ef4444;" title="Red"></button>
                        <button type="button" class="color-option" data-color="#ec4899" style="--color: #ec4899;" title="Pink"></button>
                    </div>
                </div>

                <!-- Sidebar Style -->
                <div class="setting-item">
                    <div class="setting-label">
                        <h6 class="mb-1">Sidebar mặc định</h6>
                        <p class="text-muted mb-0 small">Trạng thái sidebar khi tải trang</p>
                    </div>
                    <div class="mt-3">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="sidebarCollapsed">
                            <label class="form-check-label" for="sidebarCollapsed">Thu gọn sidebar</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- General Settings -->
    <div class="col-12 col-lg-6">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title">
                    <i class="fas fa-store"></i>
                    Thông tin cửa hàng
                </h5>
            </div>
            <div class="card-body">
                <form method="post" action="@Url.Action("UpdateGeneral")">
                    @Html.AntiForgeryToken()
                    
                    <div class="form-group mb-3">
                        <label class="form-label">Tên cửa hàng</label>
                        <input type="text" name="StoreName" class="form-control" value="LaptopStore" placeholder="Nhập tên cửa hàng">
                    </div>
                    
                    <div class="form-group mb-3">
                        <label class="form-label">Email liên hệ</label>
                        <input type="email" name="StoreEmail" class="form-control" value="contact@laptopstore.vn" placeholder="contact@example.com">
                    </div>
                    
                    <div class="form-group mb-3">
                        <label class="form-label">Số điện thoại</label>
                        <input type="text" name="StorePhone" class="form-control" value="1900-xxxx" placeholder="0xxx-xxx-xxx">
                    </div>
                    
                    <div class="form-group mb-3">
                        <label class="form-label">Địa chỉ</label>
                        <textarea name="StoreAddress" class="form-control" rows="2" placeholder="Nhập địa chỉ cửa hàng">123 Đường ABC, Quận XYZ, TP. Hồ Chí Minh</textarea>
                    </div>
                    
                    <div class="row g-3 mb-3">
                        <div class="col-6">
                            <label class="form-label">Tiền tệ</label>
                            <select name="Currency" class="form-control form-select">
                                <option value="VND" selected>VND (₫)</option>
                                <option value="USD">USD ($)</option>
                            </select>
                        </div>
                        <div class="col-6">
                            <label class="form-label">Ngôn ngữ</label>
                            <select name="Language" class="form-control form-select">
                                <option value="vi" selected>Tiếng Việt</option>
                                <option value="en">English</option>
                            </select>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save me-1"></i> Lưu thay đổi
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Notification Settings -->
    <div class="col-12 col-lg-6">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title">
                    <i class="fas fa-bell"></i>
                    Thông báo
                </h5>
            </div>
            <div class="card-body">
                <div class="setting-item d-flex justify-content-between align-items-center mb-3">
                    <div>
                        <h6 class="mb-1">Đơn hàng mới</h6>
                        <p class="text-muted mb-0 small">Nhận thông báo khi có đơn hàng mới</p>
                    </div>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="notifyNewOrder" checked>
                    </div>
                </div>
                
                <div class="setting-item d-flex justify-content-between align-items-center mb-3">
                    <div>
                        <h6 class="mb-1">Tồn kho thấp</h6>
                        <p class="text-muted mb-0 small">Cảnh báo khi sản phẩm sắp hết hàng</p>
                    </div>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="notifyLowStock" checked>
                    </div>
                </div>
                
                <div class="setting-item d-flex justify-content-between align-items-center mb-3">
                    <div>
                        <h6 class="mb-1">Đăng ký mới</h6>
                        <p class="text-muted mb-0 small">Thông báo khi có khách hàng đăng ký</p>
                    </div>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="notifyNewUser">
                    </div>
                </div>
                
                <div class="setting-item d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="mb-1">Email tổng hợp</h6>
                        <p class="text-muted mb-0 small">Gửi email tổng hợp hàng ngày</p>
                    </div>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="dailyDigest">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- System Info -->
    <div class="col-12 col-lg-6">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title">
                    <i class="fas fa-info-circle"></i>
                    Thông tin hệ thống
                </h5>
            </div>
            <div class="card-body">
                <div class="system-info-list">
                    <div class="system-info-item d-flex justify-content-between py-2 border-bottom">
                        <span class="text-muted">Phiên bản</span>
                        <span class="fw-medium">1.0.0</span>
                    </div>
                    <div class="system-info-item d-flex justify-content-between py-2 border-bottom">
                        <span class="text-muted">Framework</span>
                        <span class="fw-medium">.NET 8.0</span>
                    </div>
                    <div class="system-info-item d-flex justify-content-between py-2 border-bottom">
                        <span class="text-muted">Database</span>
                        <span class="fw-medium">SQL Server</span>
                    </div>
                    <div class="system-info-item d-flex justify-content-between py-2 border-bottom">
                        <span class="text-muted">Môi trường</span>
                        <span class="badge badge-info">Development</span>
                    </div>
                    <div class="system-info-item d-flex justify-content-between py-2">
                        <span class="text-muted">Cập nhật lần cuối</span>
                        <span class="fw-medium">@DateTime.Now.ToString("dd/MM/yyyy")</span>
                    </div>
                </div>
                
                <div class="mt-4 d-flex gap-2">
                    <button type="button" class="btn btn-secondary btn-sm" onclick="clearCache()">
                        <i class="fas fa-broom me-1"></i> Xóa cache
                    </button>
                    <button type="button" class="btn btn-secondary btn-sm" onclick="checkUpdates()">
                        <i class="fas fa-sync me-1"></i> Kiểm tra cập nhật
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .setting-item h6 {
        font-weight: 600;
        color: var(--text-primary);
    }
    
    /* Theme Options */
    .theme-options {
        display: flex;
        gap: 1rem;
    }
    
    .theme-option {
        cursor: pointer;
        text-align: center;
        transition: all var(--transition-fast);
    }
    
    .theme-option.active .theme-preview {
        border-color: var(--primary-500);
        box-shadow: 0 0 0 2px var(--primary-500);
    }
    
    .theme-preview {
        width: 100px;
        height: 70px;
        border-radius: var(--radius-md);
        border: 2px solid var(--border-color);
        overflow: hidden;
        display: flex;
        transition: all var(--transition-fast);
    }
    
    .theme-preview:hover {
        border-color: var(--primary-400);
    }
    
    .theme-preview.light {
        background: #f8fafc;
    }
    
    .theme-preview.light .theme-preview-sidebar {
        background: #1e293b;
    }
    
    .theme-preview.light .theme-preview-header {
        background: #e2e8f0;
    }
    
    .theme-preview.light .theme-preview-body {
        background: #f1f5f9;
    }
    
    .theme-preview.dark {
        background: #0f172a;
    }
    
    .theme-preview.dark .theme-preview-sidebar {
        background: #1e293b;
    }
    
    .theme-preview.dark .theme-preview-header {
        background: #334155;
    }
    
    .theme-preview.dark .theme-preview-body {
        background: #1e293b;
    }
    
    .theme-preview.auto {
        background: linear-gradient(135deg, #f8fafc 50%, #0f172a 50%);
    }
    
    .theme-preview.auto .theme-preview-sidebar {
        background: #1e293b;
    }
    
    .theme-preview.auto .theme-preview-header {
        background: linear-gradient(90deg, #e2e8f0 50%, #334155 50%);
    }
    
    .theme-preview.auto .theme-preview-body {
        background: linear-gradient(90deg, #f1f5f9 50%, #1e293b 50%);
    }
    
    .theme-preview-sidebar {
        width: 25%;
        height: 100%;
    }
    
    .theme-preview-content {
        flex: 1;
        display: flex;
        flex-direction: column;
    }
    
    .theme-preview-header {
        height: 20%;
    }
    
    .theme-preview-body {
        flex: 1;
    }
    
    .theme-label {
        display: block;
        margin-top: 0.5rem;
        font-size: 0.85rem;
        color: var(--text-secondary);
    }
    
    .theme-option.active .theme-label {
        color: var(--primary-600);
        font-weight: 600;
    }
    
    /* Color Options */
    .color-options {
        display: flex;
        gap: 0.75rem;
        flex-wrap: wrap;
    }
    
    .color-option {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: var(--color);
        border: 3px solid transparent;
        cursor: pointer;
        transition: all var(--transition-fast);
        position: relative;
    }
    
    .color-option:hover {
        transform: scale(1.1);
    }
    
    .color-option.active {
        border-color: var(--text-primary);
    }
    
    .color-option.active::after {
        content: '\f00c';
        font-family: 'Font Awesome 6 Free';
        font-weight: 900;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 0.75rem;
    }
    
    /* Form Switch Styling */
    .form-check-input {
        width: 44px;
        height: 24px;
        cursor: pointer;
    }
    
    .form-check-input:checked {
        background-color: var(--primary-500);
        border-color: var(--primary-500);
    }
    
    .form-check-input:focus {
        box-shadow: 0 0 0 3px var(--primary-100);
        border-color: var(--primary-400);
    }
</style>

@section Scripts {
    <script>
        // Initialize theme settings
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved theme
            const savedTheme = localStorage.getItem('adminTheme') || 'light';
            const savedColor = localStorage.getItem('adminPrimaryColor') || '#6366f1';
            const savedSidebarState = localStorage.getItem('adminSidebarCollapsed') === 'true';
            
            // Set active theme
            document.querySelectorAll('.theme-option').forEach(option => {
                if (option.dataset.theme === savedTheme) {
                    option.classList.add('active');
                }
                option.addEventListener('click', function() {
                    document.querySelectorAll('.theme-option').forEach(o => o.classList.remove('active'));
                    this.classList.add('active');
                    const theme = this.dataset.theme;
                    localStorage.setItem('adminTheme', theme);
                    applyTheme(theme);
                });
            });
            
            // Set active color
            document.querySelectorAll('.color-option').forEach(option => {
                if (option.dataset.color === savedColor) {
                    option.classList.add('active');
                }
                option.addEventListener('click', function() {
                    document.querySelectorAll('.color-option').forEach(o => o.classList.remove('active'));
                    this.classList.add('active');
                    const color = this.dataset.color;
                    localStorage.setItem('adminPrimaryColor', color);
                    applyPrimaryColor(color);
                });
            });
            
            // Set sidebar state
            document.getElementById('sidebarCollapsed').checked = savedSidebarState;
            document.getElementById('sidebarCollapsed').addEventListener('change', function() {
                localStorage.setItem('adminSidebarCollapsed', this.checked);
            });
        });
        
        function applyTheme(theme) {
            if (theme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
            } else if (theme === 'light') {
                document.documentElement.removeAttribute('data-theme');
            } else {
                // Auto - check system preference
                if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    document.documentElement.setAttribute('data-theme', 'dark');
                } else {
                    document.documentElement.removeAttribute('data-theme');
                }
            }
        }
        
        function applyPrimaryColor(color) {
            document.documentElement.style.setProperty('--primary-500', color);
            // Generate lighter and darker shades
            const hsl = hexToHSL(color);
            document.documentElement.style.setProperty('--primary-50', `hsl(${hsl.h}, ${hsl.s}%, 97%)`);
            document.documentElement.style.setProperty('--primary-100', `hsl(${hsl.h}, ${hsl.s}%, 93%)`);
            document.documentElement.style.setProperty('--primary-200', `hsl(${hsl.h}, ${hsl.s}%, 85%)`);
            document.documentElement.style.setProperty('--primary-400', `hsl(${hsl.h}, ${hsl.s}%, 55%)`);
            document.documentElement.style.setProperty('--primary-600', `hsl(${hsl.h}, ${hsl.s}%, 40%)`);
            document.documentElement.style.setProperty('--primary-700', `hsl(${hsl.h}, ${hsl.s}%, 35%)`);
        }
        
        function hexToHSL(hex) {
            let r = parseInt(hex.slice(1, 3), 16) / 255;
            let g = parseInt(hex.slice(3, 5), 16) / 255;
            let b = parseInt(hex.slice(5, 7), 16) / 255;
            
            let max = Math.max(r, g, b), min = Math.min(r, g, b);
            let h, s, l = (max + min) / 2;
            
            if (max === min) {
                h = s = 0;
            } else {
                let d = max - min;
                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                switch (max) {
                    case r: h = ((g - b) / d + (g < b ? 6 : 0)) / 6; break;
                    case g: h = ((b - r) / d + 2) / 6; break;
                    case b: h = ((r - g) / d + 4) / 6; break;
                }
            }
            
            return { h: Math.round(h * 360), s: Math.round(s * 100), l: Math.round(l * 100) };
        }
        
        function clearCache() {
            localStorage.clear();
            alert('Cache đã được xóa thành công!');
            location.reload();
        }
        
        function checkUpdates() {
            alert('Hệ thống đang ở phiên bản mới nhất!');
        }
    </script>
}
